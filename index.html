<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<title>MathAR</title>
<style>
@import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
:root {
  --glass-bg: rgba(28,24,20,0.72); --glass-border: rgba(255,255,255,0.14);
  --glass-shine: rgba(255,255,255,0.22); --warm-white: #f5f0ea;
  --warm-mid: #b8b0a4; --warm-muted: #6e6860;
  --accent-blue: #4a9eff; --accent-purple: #bf8fff;
  --accent-warm: #e8c070; --accent-teal: #50d8b0; --accent-rose: #e87090;
  --shadow-deep: 0 32px 80px rgba(0,0,0,.7),0 8px 24px rgba(0,0,0,.4);
  --shadow-float: 0 20px 60px rgba(0,0,0,.5),0 4px 16px rgba(0,0,0,.3);
  --r-card: 22px; --r-pill: 100px; --font: 'Inter',-apple-system,BlinkMacSystemFont,sans-serif;
}
*{margin:0;padding:0;box-sizing:border-box;-webkit-tap-highlight-color:transparent;user-select:none;}
html,body{width:100%;height:100%;overflow:hidden;background:#000;font-family:var(--font);}
#video{position:fixed;inset:0;width:100%;height:100%;object-fit:cover;z-index:0;}

/* SPLASH */
#splash{position:fixed;inset:0;z-index:500;background:radial-gradient(ellipse at 40% 35%,rgba(45,38,30,1) 0%,rgba(15,12,10,1) 70%);display:flex;flex-direction:column;align-items:center;justify-content:center;gap:0;padding:0;transition:opacity .8s,transform .8s;}
#splash.out{opacity:0;transform:scale(1.06);pointer-events:none;}
.sp-bg{position:absolute;inset:0;pointer-events:none;background:radial-gradient(circle at 50% 30%,rgba(191,143,255,.08) 0%,transparent 60%),radial-gradient(circle at 20% 80%,rgba(74,158,255,.06) 0%,transparent 40%);}
.sp-c{display:flex;flex-direction:column;align-items:center;gap:1.8rem;padding:2.8rem 2rem;width:100%;max-width:380px;position:relative;z-index:1;}
.sp-ring{width:88px;height:88px;border-radius:28px;background:linear-gradient(145deg,rgba(191,143,255,.2),rgba(74,158,255,.1));border:1px solid rgba(255,255,255,.18);display:flex;align-items:center;justify-content:center;box-shadow:0 0 60px rgba(191,143,255,.2),var(--shadow-float);position:relative;overflow:hidden;font-size:2.8rem;}
.sp-ring::before{content:'';position:absolute;top:0;left:0;right:0;height:50%;background:linear-gradient(to bottom,rgba(255,255,255,.12),transparent);border-radius:28px 28px 0 0;}
.sp-title{font-size:2.4rem;font-weight:700;letter-spacing:-1.2px;color:var(--warm-white);text-align:center;line-height:1.1;}
.sp-sub{font-size:.9rem;color:var(--warm-mid);text-align:center;line-height:1.5;}
.sp-feats{width:100%;background:var(--glass-bg);border:1px solid var(--glass-border);border-radius:var(--r-card);overflow:hidden;box-shadow:var(--shadow-float);backdrop-filter:blur(30px);-webkit-backdrop-filter:blur(30px);}
.sp-feat{display:flex;align-items:center;gap:1rem;padding:.9rem 1.3rem;border-bottom:1px solid rgba(255,255,255,.05);}
.sp-feat:last-child{border-bottom:none;}
.sp-fi{width:40px;height:40px;border-radius:12px;flex-shrink:0;display:flex;align-items:center;justify-content:center;font-size:1.15rem;position:relative;overflow:hidden;}
.sp-fi::before{content:'';position:absolute;top:0;left:0;right:0;height:50%;background:linear-gradient(to bottom,rgba(255,255,255,.15),transparent);}
.ic1{background:linear-gradient(145deg,rgba(191,143,255,.3),rgba(120,80,220,.2));}
.ic2{background:linear-gradient(145deg,rgba(74,158,255,.3),rgba(40,100,200,.2));}
.ic3{background:linear-gradient(145deg,rgba(80,216,176,.3),rgba(40,160,120,.2));}
.ic4{background:linear-gradient(145deg,rgba(232,192,112,.3),rgba(180,140,60,.2));}
.sp-ft{flex:1;}
.sp-ft-t{font-size:.88rem;font-weight:600;color:var(--warm-white);margin-bottom:.1rem;}
.sp-ft-d{font-size:.75rem;color:var(--warm-muted);line-height:1.4;}
.sp-btn{width:100%;background:linear-gradient(145deg,rgba(191,143,255,.35),rgba(120,80,220,.25));border:1px solid rgba(191,143,255,.4);border-radius:var(--r-pill);padding:1rem;font-family:var(--font);font-size:1rem;font-weight:600;color:var(--warm-white);cursor:pointer;letter-spacing:.2px;box-shadow:0 8px 32px rgba(191,143,255,.2),inset 0 1px 0 rgba(255,255,255,.15);transition:transform .14s;position:relative;overflow:hidden;}
.sp-btn::before{content:'';position:absolute;top:0;left:0;right:0;height:50%;background:linear-gradient(to bottom,rgba(255,255,255,.1),transparent);}
.sp-btn:active{transform:scale(.97);}

/* HUD */
#hud{position:fixed;top:0;left:0;right:0;z-index:80;display:none;align-items:center;justify-content:space-between;padding:1rem 1.3rem .6rem;background:linear-gradient(to bottom,rgba(10,8,6,.6) 0%,transparent 100%);pointer-events:none;}
#hud.on{display:flex;}
.hud-wm{font-size:1.1rem;font-weight:600;letter-spacing:-.4px;color:var(--warm-white);opacity:.9;}
.hud-pill{display:flex;align-items:center;gap:.5rem;background:rgba(28,24,20,.75);border:1px solid rgba(255,255,255,.16);border-radius:var(--r-pill);padding:.32rem .9rem;backdrop-filter:blur(20px);-webkit-backdrop-filter:blur(20px);box-shadow:0 4px 20px rgba(0,0,0,.4),inset 0 1px 0 rgba(255,255,255,.1);pointer-events:all;cursor:pointer;font-size:.68rem;font-weight:500;color:rgba(245,240,234,.85);letter-spacing:.5px;text-transform:uppercase;transition:background .2s;}
.hud-pill:active{background:rgba(50,40,30,.8);}
.ldot{width:6px;height:6px;border-radius:50%;background:var(--accent-teal);animation:blink 2s ease-in-out infinite;box-shadow:0 0 6px var(--accent-teal);}
@keyframes blink{0%,100%{opacity:1;}50%{opacity:.3;}}

/* SCANLINE + CORNERS */
#scanline{position:fixed;left:0;right:0;height:1px;z-index:15;display:none;background:linear-gradient(90deg,transparent,rgba(245,240,234,.25),transparent);animation:scanmove 7s linear infinite;pointer-events:none;}
#scanline.on{display:block;}
@keyframes scanmove{from{top:-1px}to{top:100vh}}
.corner{position:fixed;width:20px;height:20px;z-index:15;pointer-events:none;display:none;}
.corner.on{display:block;}
.corner::before,.corner::after{content:'';position:absolute;background:rgba(245,240,234,.3);}
.ctL{top:1rem;left:1rem}.ctL::before{top:0;left:0;width:1.5px;height:100%}.ctL::after{top:0;left:0;width:100%;height:1.5px}
.ctR{top:1rem;right:1rem}.ctR::before{top:0;right:0;width:1.5px;height:100%}.ctR::after{top:0;right:0;width:100%;height:1.5px}
.cbL{bottom:7rem;left:1rem}.cbL::before{bottom:0;left:0;width:1.5px;height:100%}.cbL::after{bottom:0;left:0;width:100%;height:1.5px}
.cbR{bottom:7rem;right:1rem}.cbR::before{bottom:0;right:0;width:1.5px;height:100%}.cbR::after{bottom:0;right:0;width:100%;height:1.5px}

/* CANVAS */
#line-canvas{position:fixed;inset:0;z-index:20;pointer-events:none;}

/* FORMULA CARD */
.fcard{position:fixed;z-index:40;background:var(--glass-bg);border:1px solid var(--glass-border);border-radius:var(--r-card);padding:0;backdrop-filter:blur(40px) saturate(1.8);-webkit-backdrop-filter:blur(40px) saturate(1.8);box-shadow:var(--shadow-float),inset 0 1px 0 var(--glass-shine);min-width:160px;max-width:210px;cursor:pointer;touch-action:none;animation:cardIn .5s cubic-bezier(.34,1.56,.64,1) forwards;overflow:hidden;transition:box-shadow .25s;}
.fcard:active{box-shadow:var(--shadow-deep);}
.fcard.dragging{box-shadow:var(--shadow-deep);z-index:200;transition:none;cursor:grabbing;}
.fcard::before{content:'';position:absolute;top:0;left:0;right:0;height:1px;background:linear-gradient(90deg,transparent,rgba(255,255,255,.35),transparent);pointer-events:none;z-index:1;}
@keyframes cardIn{from{opacity:0;transform:scale(.5) translateY(16px);}to{opacity:1;transform:scale(1) translateY(0);}}
.fc-bar{height:3px;width:100%;border-radius:var(--r-card) var(--r-card) 0 0;}
.fc-body{padding:.85rem 1rem .8rem;}
.fc-cat{font-size:.58rem;font-weight:600;letter-spacing:2px;text-transform:uppercase;opacity:.65;margin-bottom:.25rem;display:flex;align-items:center;gap:.4rem;}
.fc-name{font-size:.8rem;font-weight:600;color:var(--warm-white);margin-bottom:.15rem;letter-spacing:-.2px;}
.fc-eq{font-size:1.2rem;font-weight:700;letter-spacing:-.3px;margin:.35rem 0 .2rem;font-variant-numeric:tabular-nums;animation:eqglow 4s ease-in-out infinite;}
@keyframes eqglow{0%,100%{text-shadow:none;}50%{text-shadow:0 0 20px currentColor;}}
.fc-hint{font-size:.6rem;font-weight:500;color:rgba(245,240,234,.3);letter-spacing:.5px;margin-top:.4rem;}
.fc-close{position:absolute;top:8px;right:10px;z-index:10;width:22px;height:22px;border-radius:50%;background:rgba(255,255,255,.08);border:1px solid rgba(255,255,255,.1);display:flex;align-items:center;justify-content:center;font-size:.7rem;color:rgba(255,255,255,.5);cursor:pointer;transition:all .2s;}
.fc-close:hover{background:rgba(232,112,112,.25);color:#fff;}

/* DETAIL PANEL */
#det-bd{position:fixed;inset:0;z-index:300;background:rgba(0,0,0,.55);backdrop-filter:blur(8px);-webkit-backdrop-filter:blur(8px);display:none;align-items:flex-end;justify-content:center;}
#det-bd.on{display:flex;}
#det-bd.on #det-panel{animation:panelUp .45s cubic-bezier(.32,1,.6,1) forwards;}
@keyframes panelUp{from{transform:translateY(100%);opacity:0;}to{transform:translateY(0);opacity:1;}}
#det-panel{width:100%;max-width:480px;background:rgba(22,18,14,.93);border:1px solid var(--glass-border);border-radius:28px 28px 0 0;backdrop-filter:blur(50px) saturate(2);-webkit-backdrop-filter:blur(50px) saturate(2);box-shadow:0 -20px 80px rgba(0,0,0,.7),inset 0 1px 0 rgba(255,255,255,.18);overflow:hidden;max-height:88vh;overflow-y:auto;-webkit-overflow-scrolling:touch;}
.dp-handle{width:36px;height:4px;border-radius:2px;background:rgba(255,255,255,.2);margin:10px auto 0;}
.dp-hdr{padding:1.2rem 1.4rem 0;display:flex;align-items:flex-start;justify-content:space-between;}
.dp-cat{font-size:.6rem;font-weight:600;letter-spacing:2px;text-transform:uppercase;opacity:.55;margin-bottom:.2rem;}
.dp-title{font-size:1.35rem;font-weight:700;color:var(--warm-white);letter-spacing:-.5px;line-height:1.2;}
.dp-x{width:32px;height:32px;border-radius:50%;flex-shrink:0;background:rgba(255,255,255,.08);border:1px solid rgba(255,255,255,.1);display:flex;align-items:center;justify-content:center;font-size:.85rem;color:rgba(255,255,255,.6);cursor:pointer;transition:background .2s;}
.dp-x:hover{background:rgba(255,255,255,.15);}
.dp-eq-blk{margin:1rem 1.4rem;border-radius:16px;padding:1.2rem;text-align:center;position:relative;overflow:hidden;}
.dp-eq-blk::before{content:'';position:absolute;top:0;left:0;right:0;height:1px;background:linear-gradient(90deg,transparent,rgba(255,255,255,.2),transparent);}
.dp-eq{font-size:1.8rem;font-weight:700;letter-spacing:-.5px;margin-bottom:.4rem;}
.dp-eq-nm{font-size:.75rem;font-weight:500;opacity:.5;letter-spacing:.3px;}
.dp-sec{padding:0 1.4rem 1rem;}
.dp-sec-t{font-size:.62rem;font-weight:600;letter-spacing:2.5px;text-transform:uppercase;color:var(--warm-muted);margin-bottom:.7rem;padding-bottom:.5rem;border-bottom:1px solid rgba(255,255,255,.06);}
.dp-expl{font-size:.88rem;color:var(--warm-mid);line-height:1.65;margin-bottom:1rem;}
.dp-vars{display:flex;flex-direction:column;gap:.45rem;margin-bottom:.8rem;}
.dp-var{display:flex;align-items:center;gap:.8rem;background:rgba(255,255,255,.04);border:1px solid rgba(255,255,255,.06);border-radius:12px;padding:.6rem .9rem;}
.dp-v-sym{font-size:1rem;font-weight:700;min-width:24px;text-align:center;font-variant-numeric:tabular-nums;}
.dp-v-n{font-size:.78rem;font-weight:500;color:var(--warm-white);}
.dp-v-u{font-size:.65rem;color:var(--warm-muted);margin-top:.05rem;}
.dp-ex{background:rgba(255,255,255,.04);border:1px solid rgba(255,255,255,.06);border-radius:14px;padding:.9rem 1rem;margin-bottom:1rem;}
.dp-ex-txt{font-size:.82rem;color:var(--warm-mid);line-height:1.55;}
.dp-acts{display:flex;gap:.6rem;padding:.8rem 1.4rem 1.6rem;}
.dp-ab{flex:1;padding:.8rem;border-radius:14px;border:none;cursor:pointer;font-family:var(--font);font-size:.82rem;font-weight:600;display:flex;align-items:center;justify-content:center;gap:.4rem;transition:transform .13s;position:relative;overflow:hidden;}
.dp-ab::before{content:'';position:absolute;top:0;left:0;right:0;height:50%;background:linear-gradient(to bottom,rgba(255,255,255,.12),transparent);}
.dp-ab:active{transform:scale(.96);}
.dp-save{background:linear-gradient(145deg,rgba(74,158,255,.3),rgba(40,100,200,.2));border:1px solid rgba(74,158,255,.4);color:var(--accent-blue);}
.dp-share{background:rgba(255,255,255,.06);border:1px solid rgba(255,255,255,.1);color:var(--warm-mid);}

/* TOAST */
#toast{position:fixed;bottom:8rem;left:50%;transform:translateX(-50%) translateY(20px);z-index:600;background:rgba(22,18,14,.92);border:1px solid rgba(255,255,255,.15);border-radius:var(--r-pill);padding:.55rem 1.2rem;font-size:.78rem;font-weight:500;color:var(--warm-white);backdrop-filter:blur(20px);-webkit-backdrop-filter:blur(20px);box-shadow:var(--shadow-float);opacity:0;transition:opacity .3s,transform .3s;pointer-events:none;white-space:nowrap;}
#toast.show{opacity:1;transform:translateX(-50%) translateY(0);}

/* TOOLBAR */
#toolbar{position:fixed;bottom:0;left:0;right:0;z-index:80;display:none;padding:.6rem .8rem 1.4rem;background:linear-gradient(to top,rgba(10,8,6,.9) 50%,transparent);}
#toolbar.on{display:block;}
.tb-h{font-size:.55rem;font-weight:500;letter-spacing:2.5px;color:rgba(110,104,96,.8);text-transform:uppercase;text-align:center;margin-bottom:.55rem;}
.tb-r{display:flex;gap:.4rem;overflow-x:auto;scrollbar-width:none;padding-bottom:2px;}
.tb-r::-webkit-scrollbar{display:none;}
.tb-i{flex-shrink:0;display:flex;flex-direction:column;align-items:center;gap:.3rem;background:var(--glass-bg);border:1px solid var(--glass-border);border-radius:16px;padding:.6rem .75rem;cursor:pointer;min-width:64px;transition:all .18s;box-shadow:0 4px 16px rgba(0,0,0,.4),inset 0 1px 0 rgba(255,255,255,.08);position:relative;overflow:hidden;}
.tb-i::before{content:'';position:absolute;top:0;left:0;right:0;height:50%;background:linear-gradient(to bottom,rgba(255,255,255,.06),transparent);}
.tb-i:active{transform:scale(.93);background:rgba(40,34,26,.8);}
.tb-ico{font-size:1.3rem;position:relative;z-index:1;}
.tb-lbl{font-size:.5rem;font-weight:500;color:var(--warm-muted);text-align:center;white-space:nowrap;position:relative;z-index:1;letter-spacing:.3px;}

/* AI OVERLAY */
#ai-ov{position:fixed;inset:0;z-index:400;background:rgba(10,8,6,.85);backdrop-filter:blur(12px);-webkit-backdrop-filter:blur(12px);display:none;flex-direction:column;align-items:center;justify-content:center;gap:1.2rem;pointer-events:none;}
#ai-ov.on{display:flex;}
.ai-sp{width:64px;height:64px;border-radius:50%;border:2px solid rgba(255,255,255,.1);border-top-color:rgba(191,143,255,.8);border-right-color:rgba(74,158,255,.5);animation:spin 1s linear infinite;}
@keyframes spin{from{transform:rotate(0)}to{transform:rotate(360deg)}}
.ai-lb{font-size:.75rem;font-weight:500;color:rgba(245,240,234,.6);letter-spacing:2px;text-transform:uppercase;}

/* ERROR */
#err{position:fixed;inset:0;z-index:600;background:rgba(10,8,6,.98);display:none;flex-direction:column;align-items:center;justify-content:center;gap:1.1rem;padding:2.5rem 2rem;text-align:center;}
#err.on{display:flex;}
.e-ico{font-size:3rem;}.e-t{font-size:1.3rem;font-weight:700;color:var(--warm-white);letter-spacing:-.5px;}
.e-m{font-size:.82rem;color:var(--warm-muted);line-height:1.6;max-width:290px;}
.e-lnk{background:var(--glass-bg);border:1px solid var(--glass-border);border-radius:14px;padding:.9rem 1.2rem;font-size:.72rem;color:var(--accent-blue);letter-spacing:.3px;text-align:left;max-width:290px;width:100%;line-height:1.7;}
.e-btn{background:linear-gradient(145deg,rgba(191,143,255,.25),rgba(120,80,220,.15));border:1px solid rgba(191,143,255,.35);border-radius:var(--r-pill);padding:.75rem 2rem;font-family:var(--font);font-size:.82rem;font-weight:600;color:var(--warm-white);cursor:pointer;}
</style>
</head>
<body>
<video id="video" autoplay playsinline muted></video>
<canvas id="line-canvas"></canvas>

<div id="splash">
  <div class="sp-bg"></div>
  <div class="sp-c">
    <div class="sp-ring">âˆ‘</div>
    <div><div class="sp-title">MathAR</div><div class="sp-sub">La matematica prende vita<br>nella realtÃ  che ti circonda</div></div>
    <div class="sp-feats">
      <div class="sp-feat"><div class="sp-fi ic1">ðŸ¤–</div><div class="sp-ft"><div class="sp-ft-t">AI riconosce la scena</div><div class="sp-ft-d">Analisi intelligente degli oggetti nella stanza</div></div></div>
      <div class="sp-feat"><div class="sp-fi ic2">âœ¨</div><div class="sp-ft"><div class="sp-ft-t">Formule contestuali</div><div class="sp-ft-d">Ogni oggetto genera le formule fisiche correlate</div></div></div>
      <div class="sp-feat"><div class="sp-fi ic3">ðŸ‘†</div><div class="sp-ft"><div class="sp-ft-t">Tocca per approfondire</div><div class="sp-ft-d">Scheda dettagliata con variabili ed esempi reali</div></div></div>
      <div class="sp-feat"><div class="sp-fi ic4">ðŸ”–</div><div class="sp-ft"><div class="sp-ft-t">Salva le preferite</div><div class="sp-ft-d">Costruisci la tua raccolta di formule</div></div></div>
    </div>
    <button class="sp-btn" onclick="startAR()">Avvia fotocamera</button>
  </div>
</div>

<div id="err">
  <div class="e-ico">ðŸ”’</div><div class="e-t">Fotocamera bloccata</div>
  <div class="e-m">Apri questa app tramite il link GitHub Pages su HTTPS:</div>
  <div class="e-lnk"><span style="color:var(--warm-muted);font-size:.62rem;letter-spacing:2px;">IL TUO LINK</span><br><span style="color:var(--accent-blue);">edilorenzo700-droid.github.io/mathar</span></div>
  <button class="e-btn" onclick="location.reload()">â†» Riprova</button>
</div>

<div id="hud">
  <div class="hud-wm">MathAR</div>
  <div class="hud-pill" onclick="triggerScan()"><div class="ldot"></div><span id="hud-lbl">Scansiona</span></div>
</div>
<div id="ai-ov"><div class="ai-sp"></div><div class="ai-lb" id="ai-lbl">Analisi in corso</div></div>
<div id="scanline"></div>
<div class="corner ctL on"></div><div class="corner ctR on"></div>
<div class="corner cbL on"></div><div class="corner cbR on"></div>

<div id="det-bd" onclick="closeDet(event)">
  <div id="det-panel">
    <div class="dp-handle"></div>
    <div class="dp-hdr">
      <div><div class="dp-cat" id="dp-cat"></div><div class="dp-title" id="dp-title"></div></div>
      <div class="dp-x" onclick="closeDet()">âœ•</div>
    </div>
    <div class="dp-eq-blk" id="dp-eqb"><div class="dp-eq" id="dp-eq"></div><div class="dp-eq-nm" id="dp-eqn"></div></div>
    <div class="dp-sec"><div class="dp-sec-t">Spiegazione</div><div class="dp-expl" id="dp-expl"></div></div>
    <div class="dp-sec"><div class="dp-sec-t">Variabili</div><div class="dp-vars" id="dp-vars"></div></div>
    <div class="dp-sec"><div class="dp-sec-t">Esempio pratico</div><div class="dp-ex"><div class="dp-ex-txt" id="dp-ex"></div></div></div>
    <div class="dp-acts">
      <button class="dp-ab dp-save" onclick="saveF()">ðŸ”– Salva formula</button>
      <button class="dp-ab dp-share" onclick="shareF()">â†‘ Condividi</button>
    </div>
  </div>
</div>
<div id="toast"></div>

<div id="toolbar">
  <div class="tb-h">Aggiungi formula</div>
  <div class="tb-r" id="tb-r"></div>
</div>

<script>
const DB={
  light:{icon:'ðŸ’¡',label:'Luce & Ottica',color:'#ffd080',bg:'linear-gradient(145deg,rgba(255,208,128,.15),rgba(180,140,60,.08))',
    objects:['lamp','light','bulb','chandelier','lantern','spotlight','torch','candle'],
    formulas:[
      {name:'Legge di Snell-Descartes',eq:'nâ‚Â·sinÎ¸â‚ = nâ‚‚Â·sinÎ¸â‚‚',cat:'Ottica â€” Rifrazione',
       expl:'Quando la luce passa tra due mezzi, cambia direzione. Il prodotto indiceÃ—seno si conserva. Base di lenti, occhiali, fibre ottiche.',
       vars:[{s:'nâ‚',n:'Indice rifrazione mezzo 1',u:'adimensionale (aria=1, vetroâ‰ˆ1.5)'},{s:'Î¸â‚',n:'Angolo di incidenza',u:'gradi rispetto alla normale'},{s:'nâ‚‚',n:'Indice rifrazione mezzo 2',u:'adimensionale'},{s:'Î¸â‚‚',n:'Angolo di rifrazione',u:'gradi rispetto alla normale'}],
       ex:'Luce dall\'aria (n=1) nel vetro (n=1.5) con Î¸â‚=30Â°: sinÎ¸â‚‚ = sin30Â°/1.5 = 0.5/1.5 = 0.333 â†’ Î¸â‚‚ â‰ˆ 19.5Â°. La luce si piega verso la normale.'},
      {name:'Illuminamento da sorgente puntiforme',eq:'E = Î¦ / (4Ï€Â·rÂ²)',cat:'Fotometria',
       expl:'L\'illuminamento cala con il quadrato della distanza. Raddoppiare la distanza riduce la luce a 1/4. Usato per progettare l\'illuminazione.',
       vars:[{s:'E',n:'Illuminamento',u:'lux (lm/mÂ²)'},{s:'Î¦',n:'Flusso luminoso totale',u:'lumen (lm)'},{s:'r',n:'Distanza dalla sorgente',u:'metri'}],
       ex:'Lampadina 800 lm a 1 m: E = 800/(4Ï€) â‰ˆ 63.7 lux. A 2 m: E â‰ˆ 15.9 lux. Raddoppiata la distanza â†’ luce divisa per 4.'},
    ]},
  glass:{icon:'ðŸªŸ',label:'Vetro & Onde',color:'#8dd8ff',bg:'linear-gradient(145deg,rgba(141,216,255,.12),rgba(60,140,200,.07))',
    objects:['window','glass','mirror','lens','prism','crystal','frame','door'],
    formulas:[
      {name:'Indice di rifrazione',eq:'n = c / v',cat:'Ottica',
       expl:'Misura quanto la luce rallenta in un mezzo. Per il vetro nâ‰ˆ1.5, per il diamante n=2.42. Un indice maggiore significa luce piÃ¹ lenta.',
       vars:[{s:'n',n:'Indice di rifrazione',u:'adimensionale (sempre â‰¥ 1)'},{s:'c',n:'VelocitÃ  luce nel vuoto',u:'2.998 Ã— 10â¸ m/s'},{s:'v',n:'VelocitÃ  della luce nel mezzo',u:'m/s'}],
       ex:'Vetro: n=1.5 â†’ v = c/1.5 = 2Ã—10â¸ m/s. Diamante: n=2.42 â†’ v = c/2.42 â‰ˆ 1.24Ã—10â¸ m/s. La luce rallenta!'},
      {name:'Angolo critico (riflessione totale)',eq:'Î¸c = arcsin(nâ‚‚/nâ‚)',cat:'Ottica',
       expl:'Oltre questo angolo, la luce non esce dal mezzo denso: si riflette completamente. Principio alla base delle fibre ottiche.',
       vars:[{s:'Î¸c',n:'Angolo critico',u:'gradi'},{s:'nâ‚',n:'Mezzo piÃ¹ denso (es. vetro)',u:'nâ‚ > nâ‚‚'},{s:'nâ‚‚',n:'Mezzo meno denso (es. aria)',u:'nâ‚‚ = 1 per aria'}],
       ex:'Vetro (nâ‚=1.5) â†’ aria (nâ‚‚=1): Î¸c = arcsin(1/1.5) â‰ˆ 41.8Â°. Luce con angolo > 41.8Â° rimbalza interamente nel vetro.'},
    ]},
  surface:{icon:'ðŸ“',label:'Geometria & Fisica',color:'#80ffcc',bg:'linear-gradient(145deg,rgba(128,255,204,.1),rgba(40,160,120,.07))',
    objects:['table','desk','floor','surface','shelf','counter','bench','board','wall','ceiling','ground'],
    formulas:[
      {name:'Teorema di Pitagora',eq:'cÂ² = aÂ² + bÂ²',cat:'Geometria euclidea',
       expl:'In ogni triangolo rettangolo, il quadrato dell\'ipotenusa Ã¨ uguale alla somma dei quadrati dei due cateti. Dimostrato 2500 anni fa, ancora usato ogni giorno.',
       vars:[{s:'c',n:'Ipotenusa (lato opposto all\'angolo retto)',u:'qualsiasi unitÃ  di lunghezza'},{s:'a',n:'Primo cateto',u:'stessa unitÃ  di c'},{s:'b',n:'Secondo cateto',u:'stessa unitÃ  di c'}],
       ex:'Tavolo 3m Ã— 4m: diagonale = âˆš(3Â²+4Â²) = âˆš(9+16) = âˆš25 = 5 m. La tripletta (3,4,5) Ã¨ la piÃ¹ nota. Altre: (5,12,13), (8,15,17).'},
      {name:'Forza di attrito',eq:'f = Î¼ Â· N',cat:'Dinamica',
       expl:'La forza che si oppone allo scorrimento tra superfici. Î¼ dipende dai materiali: gomma/asfaltoâ‰ˆ0.7, legno/legnoâ‰ˆ0.3, ghiaccio/ghiaccioâ‰ˆ0.03.',
       vars:[{s:'f',n:'Forza di attrito',u:'N (Newton)'},{s:'Î¼',n:'Coefficiente di attrito',u:'adimensionale (0.01 â€“ 0.9)'},{s:'N',n:'Forza normale (perp. alla superficie)',u:'N (Newton)'}],
       ex:'Libro 1 kg (N=9.8N) su legno (Î¼=0.3): f = 0.3 Ã— 9.8 = 2.94 N. Serve questa forza minima per farlo scivolare.'},
      {name:'Pressione',eq:'P = F / A',cat:'Fisica',
       expl:'La pressione misura come una forza si distribuisce su un\'area. Stessa forza su area minore = pressione maggiore. Per questo i chiodi hanno la punta.',
       vars:[{s:'P',n:'Pressione',u:'Pa = Pascal = N/mÂ²'},{s:'F',n:'Forza applicata',u:'N (Newton)'},{s:'A',n:'Area su cui agisce la forza',u:'mÂ²'}],
       ex:'Libro 2 kg (F=19.6N) su base 20Ã—30 cm (A=0.06 mÂ²): P = 19.6/0.06 â‰ˆ 327 Pa. Pressione atmosferica = 101325 Pa per confronto.'},
    ]},
  person:{icon:'ðŸ§‘',label:'Biomeccanica',color:'#ff9fd4',bg:'linear-gradient(145deg,rgba(255,159,212,.1),rgba(200,60,100,.07))',
    objects:['person','man','woman','human','face','body','people','student','teacher','figure','child'],
    formulas:[
      {name:'Seconda legge di Newton',eq:'F = m Â· a',cat:'Dinamica newtoniana',
       expl:'La forza risultante su un corpo determina la sua accelerazione. PiÃ¹ Ã¨ grande la massa, piÃ¹ forza serve per la stessa accelerazione. Base di tutta la meccanica classica.',
       vars:[{s:'F',n:'Forza risultante',u:'N (Newton)'},{s:'m',n:'Massa del corpo',u:'kg'},{s:'a',n:'Accelerazione',u:'m/sÂ²'}],
       ex:'Persona 70 kg accelera a 2 m/sÂ²: F = 70 Ã— 2 = 140 N. Stessa forza su 35 kg: a = 140/35 = 4 m/sÂ² (doppia accelerazione).'},
      {name:'Energia cinetica',eq:'Eâ‚– = Â½ Â· m Â· vÂ²',cat:'Energia',
       expl:'L\'energia posseduta da un corpo in movimento. Cresce con il quadrato della velocitÃ : raddoppiare v quadruplica Eâ‚–. Per questo in auto la velocitÃ  Ã¨ pericolosa.',
       vars:[{s:'Eâ‚–',n:'Energia cinetica',u:'J (Joule)'},{s:'m',n:'Massa',u:'kg'},{s:'v',n:'VelocitÃ ',u:'m/s'}],
       ex:'Persona 70 kg a 1.4 m/s (passo): Eâ‚– = Â½Ã—70Ã—1.96 = 68.6 J. In auto a 50 km/h (13.9 m/s): Eâ‚– = Â½Ã—1200Ã—193 â‰ˆ 115,700 J â€” 1686 volte di piÃ¹!'},
    ]},
  book:{icon:'ðŸ“š',label:'Matematica Pura',color:'#c4a8ff',bg:'linear-gradient(145deg,rgba(196,168,255,.12),rgba(120,80,220,.07))',
    objects:['book','notebook','paper','laptop','computer','screen','monitor','keyboard','tablet','phone','magazine'],
    formulas:[
      {name:'IdentitÃ  di Eulero',eq:'eâ±áµ– + 1 = 0',cat:'Analisi complessa',
       expl:'Considerata la piÃ¹ bella equazione della matematica: unisce e (crescita), i (immaginario), Ï€ (geometria), 1 (identitÃ ) e 0 (nulla) in una sola relazione.',
       vars:[{s:'e',n:'Numero di Nepero',u:'â‰ˆ 2.71828... (base logaritmo naturale)'},{s:'i',n:'UnitÃ  immaginaria',u:'iÂ² = âˆ’1'},{s:'Ï€',n:'Pi greco',u:'â‰ˆ 3.14159... (rapporto circonf./diametro)'}],
       ex:'Dalla formula di Euler: e^(iÎ¸) = cosÎ¸ + iÂ·sinÎ¸. Per Î¸=Ï€: e^(iÏ€) = cos Ï€ + iÂ·sin Ï€ = âˆ’1 + 0Â·i = âˆ’1. Quindi e^(iÏ€) + 1 = 0. âˆŽ'},
      {name:'Formula quadratica',eq:'x = (âˆ’b Â± âˆšÎ”) / 2a',cat:'Algebra â€” Equazioni 2Â° grado',
       expl:'Soluzione generale di axÂ²+bx+c=0. Il discriminante Î”=bÂ²âˆ’4ac dice quante soluzioni reali esistono: Î”>0 due, Î”=0 una, Î”<0 nessuna (complesse).',
       vars:[{s:'a,b,c',n:'Coefficienti (a â‰  0)',u:'numeri reali'},{s:'Î”',n:'Discriminante = bÂ²âˆ’4ac',u:'Î”>0: 2 sol. | Î”=0: 1 sol. | Î”<0: 0 sol. reali'},{s:'x',n:'Soluzioni (radici)',u:'numeri reali o complessi'}],
       ex:'xÂ²âˆ’5x+6=0 â†’ a=1,b=âˆ’5,c=6. Î”=25âˆ’24=1. x=(5Â±1)/2 â†’ xâ‚=3, xâ‚‚=2. Verifica: (3)Â²âˆ’5(3)+6 = 9âˆ’15+6 = 0 âœ“'},
    ]},
  sky:{icon:'ðŸŒ¤',label:'Termodinamica',color:'#8dd8ff',bg:'linear-gradient(145deg,rgba(141,216,255,.1),rgba(60,140,220,.07))',
    objects:['sky','cloud','outdoor','outside','tree','plant','nature','atmosphere','air','wind'],
    formulas:[
      {name:'Legge dei gas ideali',eq:'PÂ·V = nÂ·RÂ·T',cat:'Termodinamica',
       expl:'Descrive il comportamento dei gas: pressione, volume e temperatura sono legati. Riscaldare un gas â†’ si espande o aumenta la pressione.',
       vars:[{s:'P',n:'Pressione',u:'Pa (Pascal)'},{s:'V',n:'Volume',u:'mÂ³'},{s:'n',n:'Numero di moli',u:'mol'},{s:'R',n:'Costante universale dei gas',u:'8.314 J/(molÂ·K)'},{s:'T',n:'Temperatura assoluta',u:'K = Â°C + 273.15'}],
       ex:'1 mole d\'aria a 25Â°C (298 K) a pressione atm: V = nRT/P = 1Ã—8.314Ã—298/101325 â‰ˆ 0.0244 mÂ³ = 24.4 litri. Ãˆ il "volume molare".'},
      {name:'Primo principio termodinamica',eq:'Î”U = Q âˆ’ W',cat:'Termodinamica',
       expl:'L\'energia interna cambia per il calore assorbito meno il lavoro compiuto. L\'energia totale si conserva: non si crea nÃ© si distrugge.',
       vars:[{s:'Î”U',n:'Variazione di energia interna',u:'J (Joule)'},{s:'Q',n:'Calore assorbito dal sistema',u:'J (positivo = assorbito)'},{s:'W',n:'Lavoro compiuto dal sistema',u:'J (positivo = compiuto)'}],
       ex:'Gas assorbe Q=500 J e compie lavoro W=200 J: Î”U = 500âˆ’200 = 300 J. L\'energia interna (temperatura) aumenta.'},
    ]},
  default:{icon:'âœ¨',label:'Fisica Universale',color:'#bf8fff',bg:'linear-gradient(145deg,rgba(191,143,255,.12),rgba(120,80,220,.07))',
    objects:[],
    formulas:[
      {name:'Equazione di Einstein',eq:'E = m Â· cÂ²',cat:'RelativitÃ  ristretta',
       expl:'La massa Ã¨ energia concentrata. Ãˆ alla base del funzionamento del Sole, delle stelle e dell\'energia nucleare. Un grammo di materia = energia enorme.',
       vars:[{s:'E',n:'Energia',u:'J (Joule)'},{s:'m',n:'Massa a riposo',u:'kg'},{s:'c',n:'VelocitÃ  della luce nel vuoto',u:'2.998 Ã— 10â¸ m/s'}],
       ex:'1 kg di materia: E = 1 Ã— (3Ã—10â¸)Â² = 9Ã—10Â¹â¶ J â‰ˆ 21.5 milioni di tonnellate di TNT. Il Sole brucia 4 milioni di tonnellate di massa al secondo.'},
      {name:'Gravitazione universale',eq:'F = GÂ·mâ‚Â·mâ‚‚ / rÂ²',cat:'Meccanica celeste',
       expl:'Ogni coppia di masse si attrae. La forza cala con rÂ². Spiega orbite dei pianeti, maree, caduta dei gravi â€” dalla mela di Newton alle galassie.',
       vars:[{s:'F',n:'Forza gravitazionale',u:'N (Newton)'},{s:'G',n:'Costante gravitaz. universale',u:'6.674 Ã— 10â»Â¹Â¹ NÂ·mÂ²/kgÂ²'},{s:'mâ‚,mâ‚‚',n:'Masse dei due corpi',u:'kg'},{s:'r',n:'Distanza tra i centri di massa',u:'m'}],
       ex:'Terra (5.97Ã—10Â²â´ kg) + persona 70 kg a 6.37Ã—10â¶ m: F = 6.67Ã—10â»Â¹Â¹ Ã— 5.97Ã—10Â²â´ Ã— 70 / (6.37Ã—10â¶)Â² â‰ˆ 686 N. Ãˆ esattamente il tuo peso!'},
    ]}
};

let bubbles=[],zTop=30,curDet=null,saved=[];
const canvas=document.getElementById('line-canvas');
const ctx=canvas.getContext('2d');
function rsz(){canvas.width=window.innerWidth;canvas.height=window.innerHeight;}
window.addEventListener('resize',rsz);rsz();

async function startAR(){
  try{
    const s=await navigator.mediaDevices.getUserMedia({video:{facingMode:{ideal:'environment'},width:{ideal:1920},height:{ideal:1080}},audio:false});
    const v=document.getElementById('video');v.srcObject=s;v.style.transform='none';await v.play();
    document.getElementById('splash').classList.add('out');
    setTimeout(()=>document.getElementById('splash').style.display='none',800);
    document.getElementById('hud').classList.add('on');
    document.getElementById('toolbar').classList.add('on');
    document.getElementById('scanline').classList.add('on');
    buildTB();drawLines();setTimeout(triggerScan,1500);
  }catch(e){console.error(e);document.getElementById('err').classList.add('on');}
}

async function triggerScan(){
  const ov=document.getElementById('ai-ov');const lb=document.getElementById('ai-lbl');
  ov.classList.add('on');ov.style.pointerEvents='all';
  document.getElementById('hud-lbl').textContent='Analisiâ€¦';
  const v=document.getElementById('video');
  const sn=document.createElement('canvas');sn.width=Math.min(v.videoWidth||640,640);sn.height=Math.min(v.videoHeight||480,480);
  sn.getContext('2d').drawImage(v,0,0,sn.width,sn.height);
  const b64=sn.toDataURL('image/jpeg',.75).split(',')[1];
  lb.textContent='Identifico gli oggettiâ€¦';
  try{
    const r=await fetch('https://api.anthropic.com/v1/messages',{method:'POST',headers:{'Content-Type':'application/json'},
      body:JSON.stringify({model:'claude-sonnet-4-20250514',max_tokens:150,messages:[{role:'user',content:[
        {type:'image',source:{type:'base64',media_type:'image/jpeg',data:b64}},
        {type:'text',text:'List ONLY objects in this room. Reply with comma-separated English words only, max 6. No extra text. Example: table, lamp, window, book'}
      ]}]})});
    const d=await r.json();const raw=d.content?.[0]?.text||'';
    const det=raw.toLowerCase().split(',').map(s=>s.trim()).filter(Boolean);
    ov.classList.remove('on');ov.style.pointerEvents='none';process(det);
  }catch(e){ov.classList.remove('on');ov.style.pointerEvents='none';process(['table','lamp','window']);}
}

function process(det){
  const m=new Set();
  det.forEach(w=>Object.entries(DB).forEach(([k,c])=>{if(k==='default')return;if(c.objects.some(o=>w.includes(o)||o.includes(w)))m.add(k);}));
  if(m.size===0)m.add('default');
  bubbles.forEach(b=>b.el?.remove());bubbles=[];
  const keys=[...m].slice(0,4);const vw=window.innerWidth,vh=window.innerHeight;
  const pos=[{x:vw*.05,y:vh*.10},{x:vw*.48,y:vh*.08},{x:vw*.04,y:vh*.46},{x:vw*.5,y:vh*.48}];
  const ori=[{x:vw*.28,y:vh*.52},{x:vw*.65,y:vh*.45},{x:vw*.25,y:vh*.68},{x:vw*.68,y:vh*.65}];
  keys.forEach((k,i)=>{const c=DB[k];spawnCard(c.formulas[0],c,pos[i]||{x:vw*.1,y:vh*.1},ori[i]||{x:vw*.5,y:vh*.5});});
  document.getElementById('hud-lbl').textContent=keys.length+' oggetti';
}

function spawnCard(f,cat,pos,ori){
  const el=document.createElement('div');el.className='fcard';
  el.style.cssText=`left:${pos.x}px;top:${pos.y}px;z-index:${++zTop};`;
  el.innerHTML=`<div class="fc-bar" style="background:${cat.color}55;"></div><div class="fc-close" onclick="rmCard(this.parentNode)">âœ•</div><div class="fc-body"><div class="fc-cat" style="color:${cat.color}">${cat.icon} ${cat.label}</div><div class="fc-name">${f.name}</div><div class="fc-eq" style="color:${cat.color}">${f.eq}</div><div class="fc-hint">ðŸ‘† Tocca per dettagli</div></div>`;
  el.querySelector('.fc-body').addEventListener('click',()=>openDet(f,cat));
  document.body.appendChild(el);
  const b={el,x:pos.x,y:pos.y,ox:ori.x,oy:ori.y,color:cat.color};
  bubbles.push(b);drag(el,b);pinch(el);return b;
}

function rmCard(el){el.style.transition='opacity .3s,transform .3s';el.style.opacity='0';el.style.transform='scale(.5)';setTimeout(()=>{el.remove();bubbles=bubbles.filter(b=>b.el!==el);},300);}

function openDet(f,cat){
  curDet={f,cat};
  document.getElementById('dp-cat').textContent=f.cat;document.getElementById('dp-cat').style.color=cat.color;
  document.getElementById('dp-title').textContent=f.name;
  const eb=document.getElementById('dp-eqb');eb.style.background=cat.bg;eb.style.border=`1px solid ${cat.color}25`;
  document.getElementById('dp-eq').textContent=f.eq;document.getElementById('dp-eq').style.color=cat.color;
  document.getElementById('dp-eqn').textContent=f.name;
  document.getElementById('dp-expl').textContent=f.expl;
  document.getElementById('dp-vars').innerHTML=f.vars.map(v=>`<div class="dp-var"><div class="dp-v-sym" style="color:${cat.color}">${v.s}</div><div><div class="dp-v-n">${v.n}</div><div class="dp-v-u">${v.u}</div></div></div>`).join('');
  document.getElementById('dp-ex').textContent=f.ex;
  document.getElementById('det-bd').classList.add('on');
}
function closeDet(e){if(e&&e.target!==document.getElementById('det-bd'))return;document.getElementById('det-bd').classList.remove('on');}

function saveF(){if(!curDet)return;const k=curDet.f.name;if(!saved.find(s=>s===k))saved.push(k);toast('ðŸ”– "'+curDet.f.name+'" salvata');document.getElementById('det-bd').classList.remove('on');}
function shareF(){if(!curDet)return;const f=curDet.f;const t=f.name+'\n'+f.eq+'\n\n'+f.expl+'\n\nMathAR';if(navigator.share){navigator.share({title:'MathAR â€” '+f.name,text:t}).catch(()=>{});}else{navigator.clipboard?.writeText(t).then(()=>toast('ðŸ“‹ Copiata negli appunti'));}}
function toast(msg){const t=document.getElementById('toast');t.textContent=msg;t.classList.add('show');setTimeout(()=>t.classList.remove('show'),2800);}

function drawLines(){
  ctx.clearRect(0,0,canvas.width,canvas.height);const t=performance.now();
  bubbles.forEach(b=>{
    if(!b.el?.isConnected)return;const r=b.el.getBoundingClientRect();const bx=r.left+r.width/2,by=r.top;
    ctx.save();ctx.setLineDash([3,7]);ctx.lineDashOffset=-(t/50);ctx.strokeStyle=b.color+'44';ctx.lineWidth=1;
    ctx.beginPath();ctx.moveTo(b.ox,b.oy);ctx.lineTo(bx,by);ctx.stroke();
    ctx.setLineDash([]);ctx.fillStyle=b.color+'cc';ctx.beginPath();ctx.arc(b.ox,b.oy,4,0,Math.PI*2);ctx.fill();
    ctx.strokeStyle=b.color+'55';ctx.lineWidth=1;ctx.beginPath();ctx.arc(b.ox,b.oy,7,0,Math.PI*2);ctx.stroke();
    const ph=(t%2500)/2500;const al=Math.floor((1-ph)*120).toString(16).padStart(2,'0');
    ctx.strokeStyle=b.color+al;ctx.lineWidth=1;ctx.beginPath();ctx.arc(b.ox,b.oy,ph*24,0,Math.PI*2);ctx.stroke();
    ctx.restore();
  });
  requestAnimationFrame(drawLines);
}

function drag(el,bubble){
  let d=false,sx,sy,il,it;
  const dn=e=>{if(e.target.classList.contains('fc-close'))return;d=true;el.classList.add('dragging');el.style.zIndex=++zTop;const t=e.touches?e.touches[0]:e;sx=t.clientX;sy=t.clientY;il=parseFloat(el.style.left)||0;it=parseFloat(el.style.top)||0;e.preventDefault();};
  const mv=e=>{if(!d)return;const t=e.touches?e.touches[0]:e;el.style.left=(il+t.clientX-sx)+'px';el.style.top=(it+t.clientY-sy)+'px';if(bubble){bubble.x=parseFloat(el.style.left);bubble.y=parseFloat(el.style.top);}e.preventDefault();};
  const up=()=>{d=false;el.classList.remove('dragging');};
  el.addEventListener('touchstart',dn,{passive:false});el.addEventListener('touchmove',mv,{passive:false});el.addEventListener('touchend',up);
  el.addEventListener('mousedown',dn);window.addEventListener('mousemove',mv);window.addEventListener('mouseup',up);
}
function pinch(el){let id=null,is=1;el.addEventListener('touchstart',e=>{if(e.touches.length===2){id=dst(e.touches);is=gts(el);}},{passive:true});el.addEventListener('touchmove',e=>{if(e.touches.length===2&&id){const s=Math.max(.5,Math.min(2.5,is*dst(e.touches)/id));el.style.transform=`scale(${s})`;}},{passive:true});el.addEventListener('touchend',()=>id=null);}
const dst=t=>Math.hypot(t[0].clientX-t[1].clientX,t[0].clientY-t[1].clientY);
const gts=el=>{const m=(el.style.transform||'').match(/scale\(([^)]+)\)/);return m?+m[1]:1;};

function buildTB(){
  const r=document.getElementById('tb-r');
  Object.entries(DB).forEach(([k,c])=>{
    const b=document.createElement('div');b.className='tb-i';
    b.innerHTML=`<div class="tb-ico">${c.icon}</div><div class="tb-lbl">${c.label.split('&')[0].trim()}</div>`;
    b.addEventListener('pointerdown',()=>{const vw=window.innerWidth,vh=window.innerHeight;const f=c.formulas[Math.floor(Math.random()*c.formulas.length)];spawnCard(f,c,{x:vw*.1+Math.random()*vw*.55,y:vh*.1+Math.random()*vh*.35},{x:vw*.4+Math.random()*vw*.2,y:vh*.45+Math.random()*vh*.15});});
    r.appendChild(b);
  });
}
document.addEventListener('touchmove',e=>e.preventDefault(),{passive:false});
</script>
</body>
</html>
